<div class="datasets-container">
    <div class="datasets-header">
        <h2 class="page-title">
            <i class="bi bi-database me-2"></i>Datasets
        </h2>
        <p class="page-subtitle">Manage and view your data collections</p>
    </div>

    <div class="datasets-content">
        <!-- Loading State -->
        <div *ngIf="isLoading" class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 text-muted">Loading datasets...</p>
        </div>

        <!-- Error State -->
        <div *ngIf="errorMessage && !isLoading" class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>{{ errorMessage }}
        </div>

        <!-- jqxTabs with Grid View and Card View -->
        <div *ngIf="!isLoading && !errorMessage" class="tabs-container">
            <jqxTabs #jqxTabs
                     [width]="'100%'"
                     [height]="getHeight()"
                     [theme]="'metro'">
                <ul>
                    <li style="margin-left: 0;">
                        <div style="height: 20px; margin-top: 5px;">
                            <div style="float: left; margin-right: 8px;">
                                <i class="bi bi-grid-3x3-gap" style="font-size: 16px;"></i>
                            </div>
                            <div style="vertical-align: middle; text-align: center; float: left;">
                                Grid View
                            </div>
                        </div>
                    </li>
                    <li>
                        <div style="height: 20px; margin-top: 5px;">
                            <div style="float: left; margin-right: 8px;">
                                <i class="bi bi-card-list" style="font-size: 16px;"></i>
                            </div>
                            <div style="vertical-align: middle; text-align: center; float: left;">
                                Card View
                            </div>
                        </div>
                    </li>
                </ul>

                <!-- Grid View Tab Content -->
                <div style="overflow: hidden;">
                    <div *ngIf="datasets.length === 0" class="text-center py-5">
                        <i class="bi bi-inbox" style="font-size: 48px; color: var(--navy-text-light);"></i>
                        <p class="mt-3 text-muted">No datasets found</p>
                    </div>
                    <div *ngIf="datasets.length > 0" [style.min-height]="getMinHeight()">
                        <jqxGrid
                            #datasetsGrid
                            [height]="'100%'" [width]="'100%'"
                            [source]="datasetsDataAdapter" [columns]="gridColumns"
                            [sortable]="true"
                            [altrows]="true" [columnsresize]="true" [filterable]="true" [enabletooltips]="true"
                            [editable]="false">
                        </jqxGrid>
<!--                        [pageable]="true" [pagesize]="50"-->
                    </div>
                </div>

                <!-- Card View Tab Content -->
                <div style="overflow: hidden; padding: 10px;">
                    <!-- Statistics Cards -->
                    <div class="stats-cards-container">
                        <!-- Total Datasets Card -->
                        <div class="stat-card stat-card-primary">
                            <div class="stat-card-icon">
                                <i class="bi bi-database"></i>
                            </div>
                            <div class="stat-card-content">
                                <div class="stat-card-value">{{ datasets.length }}</div>
                                <div class="stat-card-label">Total Datasets</div>
                            </div>
                        </div>

                        <!-- Active Datasets Card -->
                        <div class="stat-card stat-card-success">
                            <div class="stat-card-icon">
                                <i class="bi bi-check-circle"></i>
                            </div>
                            <div class="stat-card-content">
                                <div class="stat-card-value">{{ getActiveDatasetsCount() }}</div>
                                <div class="stat-card-label">Active Datasets</div>
                            </div>
                        </div>

                        <!-- Inactive Datasets Card -->
                        <div class="stat-card stat-card-warning">
                            <div class="stat-card-icon">
                                <i class="bi bi-x-circle"></i>
                            </div>
                            <div class="stat-card-content">
                                <div class="stat-card-value">{{ getInactiveDatasetsCount() }}</div>
                                <div class="stat-card-label">Inactive Datasets</div>
                            </div>
                        </div>

                        <!-- Total Dependencies Card -->
                        <div class="stat-card stat-card-info">
                            <div class="stat-card-icon">
                                <i class="bi bi-diagram-3"></i>
                            </div>
                            <div class="stat-card-content">
                                <div class="stat-card-value">{{ getTotalDependencies() }}</div>
                                <div class="stat-card-label">Total Dependencies</div>
                            </div>
                        </div>
                    </div>

                    <!-- Datasets by Type -->
                    <div class="stats-section">
                        <h4 class="stats-section-title">
                            <i class="bi bi-pie-chart me-2"></i>Datasets by Type
                        </h4>
                        <div class="stats-cards-container">
                            <div *ngFor="let typeCount of getDatasetsByType() | keyvalue" class="stat-card stat-card-secondary">
                                <div class="stat-card-icon">
                                    <i class="bi" [ngClass]="{
                                        'bi-filetype-delta': typeCount.key === 'delta',
                                        'bi-cloud': typeCount.key === 'adls',
                                        'bi-file-earmark': typeCount.key !== 'delta' && typeCount.key !== 'adls'
                                    }"></i>
                                </div>
                                <div class="stat-card-content">
                                    <div class="stat-card-value">{{ typeCount.value }}</div>
                                    <div class="stat-card-label">{{ typeCount.key | uppercase }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Datasets by Layer -->
                    <div class="stats-section">
                        <h4 class="stats-section-title">
                            <i class="bi bi-layers me-2"></i>Datasets by Layer
                        </h4>
                        <div class="stats-cards-container">
                            <div *ngFor="let layerCount of getDatasetsByLayer() | keyvalue" class="stat-card" 
                                 [ngClass]="{
                                     'stat-card-bronze': layerCount.key === 'bronze',
                                     'stat-card-silver': layerCount.key === 'silver',
                                     'stat-card-gold': layerCount.key === 'gold',
                                     'stat-card-secondary': layerCount.key !== 'bronze' && layerCount.key !== 'silver' && layerCount.key !== 'gold'
                                 }">
                                <div class="stat-card-icon">
                                    <i class="bi bi-stack"></i>
                                </div>
                                <div class="stat-card-content">
                                    <div class="stat-card-value">{{ layerCount.value }}</div>
                                    <div class="stat-card-label">{{ layerCount.key | titlecase }} Layer</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Stats -->
                    <div class="stats-section">
                        <h4 class="stats-section-title">
                            <i class="bi bi-graph-up me-2"></i>Additional Statistics
                        </h4>
                        <div class="stats-cards-container">
                            <div class="stat-card stat-card-info">
                                <div class="stat-card-icon">
                                    <i class="bi bi-link-45deg"></i>
                                </div>
                                <div class="stat-card-content">
                                    <div class="stat-card-value">{{ getDatasetsWithDependencies() }}</div>
                                    <div class="stat-card-label">Datasets with Dependencies</div>
                                </div>
                            </div>

                            <div class="stat-card stat-card-secondary">
                                <div class="stat-card-icon">
                                    <i class="bi bi-box"></i>
                                </div>
                                <div class="stat-card-content">
                                    <div class="stat-card-value">{{ datasets.length - getDatasetsWithDependencies() }}</div>
                                    <div class="stat-card-label">Standalone Datasets</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </jqxTabs>
        </div>
    </div>
</div>
